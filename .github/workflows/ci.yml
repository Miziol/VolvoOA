name: AutoApp

on: [push, pull_request]

jobs:
  install_requierments:
    runs-on: ubuntu-latest
    steps:
      - name: Setup environment
        run: |
          ls -l
          pwd
          sudo ./install_requirements.sh
        

  qmllint:
    runs-on: ubuntu-latest
    steps:
      - name: Install qmllint
        run: sudo apt install -y qt6-qmllint-plugins
      - name: Run QML Check
        run: find autoapp/src/frontend -type f -name "*.qml" -exec qmllint {} \;

  clang:
    runs-on: ubuntu-latest
    steps:
      - name: Install clang
        run: sudo apt-get update && sudo apt-get install -y clang-format
      - name: Run Clang Check
        run: find . -name "*.cpp" -o -name "*.h" | xargs clang-format --dry-run --Werror

  build-autoapp:
    needs: [clang, qmllint, install_requierments]
    runs-on: ubuntu-latest
    steps:
      - name: Build with CMake
        run: |
          cmake -S . -B build
          cmake --build build

  build-arduino:
    needs: [clang, install_requierments]
    runs-on: ubuntu-latest
    steps:
      - name: Compile Sketch
        run: |
          arduino-cli core install arduino:avr # lub inna p≈Çytka
          arduino-cli compile --fqbn arduino:avr:uno ./path/to/sketch